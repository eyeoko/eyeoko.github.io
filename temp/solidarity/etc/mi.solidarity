% Meta-interpretation
% Original code from https://www.youtube.com/watch?v=nmBkU-l1zyc&t=1870s

'https://josd.github.io/ns#mi'([],-).
'https://josd.github.io/ns#mi'([G|Gs],-) <=
    'https://josd.github.io/ns#head_body_'([G,Goals],Gs),
    'https://josd.github.io/ns#mi'(Goals,-).

'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#mi'([],-),Rs],Rs).
'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#mi'([G|Gs],-),['https://josd.github.io/ns#head_body_'([G,Goals],Gs),'https://josd.github.io/ns#mi'(Goals,-)|Rs]],Rs).

'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#head_body_'([Head,Goals0],Goals),Rs],Rs) <=
    'https://josd.github.io/ns#head_body_'([Head,Goals0],Goals).

'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#factorial'(0,'https://josd.github.io/ns#s'(0,-)),Rs],Rs).
'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#factorial'('https://josd.github.io/ns#s'(N,-),F),['https://josd.github.io/ns#factorial'(N,F1),'https://josd.github.io/ns#prod'(['https://josd.github.io/ns#s'(N,-),F1],F)|Rs]],Rs).

'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#prod'([0,_],0),Rs],Rs).
'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#prod'(['https://josd.github.io/ns#s'(N,-),M],P),['https://josd.github.io/ns#prod'([N,M],K),'https://josd.github.io/ns#sum'([K,M],P)|Rs]],Rs).

'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#sum'([0,M],M),Rs],Rs).
'https://josd.github.io/ns#head_body_'(['https://josd.github.io/ns#sum'(['https://josd.github.io/ns#s'(N,-),M],'https://josd.github.io/ns#s'(K,-)),['https://josd.github.io/ns#sum'([N,M],K)|Rs]],Rs).

% query
'https://josd.github.io/ns#mi'(['https://josd.github.io/ns#mi'(['https://josd.github.io/ns#factorial'('https://josd.github.io/ns#s'('https://josd.github.io/ns#s'('https://josd.github.io/ns#s'('https://josd.github.io/ns#s'('https://josd.github.io/ns#s'(0,-),-),-),-),-),_X)],-)],-) => true.
